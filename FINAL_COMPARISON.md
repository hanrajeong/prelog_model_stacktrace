# 🏆 금융권 로그 분석기 - 최종 성능 비교

## 📊 전체 결과 요약

| 버전 | 설명 | Accuracy | Precision | Recall | F1 Score |
|------|------|----------|-----------|--------|----------|
| **V1** | Stage 1 분류기 단독 | 47.8% | 39.6% | 39.6% | 34.9% |
| **V2** | End-to-End (분류 + 생성) | 76.6% | 74.9% | 64.7% | 67.9% |
| **V3** | Hybrid (Rule + V2) | **78.4%** | 73.4% | 65.1% | 67.3% |

### 🎯 핵심 성과

- **V2 vs V1**: +28.8% 정확도 향상 (47.8% → 76.6%)
- **V3 vs V2**: +1.8% 정확도 향상 (76.6% → 78.4%)
- **V3 vs V1**: +30.6% 정확도 향상 (47.8% → 78.4%)

---

## 📈 버전별 상세 분석

### V1: Stage 1 분류기 (PreLog)

**아키텍처:**
- PreLog 모델 단독 사용
- Top-1 예외 타입 예측

**성능:**
- Accuracy: 47.8%
- Precision: 39.6%
- Recall: 39.6%
- F1 Score: 34.9%

**장점:**
- ✅ 빠른 추론 속도 (~0.5초)
- ✅ 단순한 구조

**단점:**
- ❌ 낮은 정확도 (50% 미만)
- ❌ 상세 분석 없음
- ❌ 44개 예외 타입 중 절반만 맞춤

---

### V2: End-to-End 파이프라인

**아키텍처:**
- **Stage 1**: PreLog (예외 타입 분류)
- **Stage 2**: T5 (상세 분석 생성)
- 2-Stage 파이프라인

**성능:**
- Accuracy: 76.6%
- Precision: 74.9%
- Recall: 64.7%
- F1 Score: 67.9%

**장점:**
- ✅ 높은 정확도 (V1 대비 +28.8%)
- ✅ 구조화된 상세 분석 제공
  - Exception Type
  - Code Location (파일, 라인, 메소드)
  - 원인 분석
  - 해결 방법
- ✅ Stage 2가 Stage 1 오류 보정

**단점:**
- ⚠️ 느린 속도 (~3-5초)
- ⚠️ 두 모델 모두 로드 필요

**개선 포인트:**
- Stage 2의 예외 타입 추출 로직 개선
- `<exception_type>...</exception_type>` 파싱 정확도 향상

---

### V3: Hybrid (Rule-based + V2)

**아키텍처:**
```
입력 로그
    ↓
Rule-based 검증 (0.01초)
    ↓
명확한 패턴?
    ↓ Yes (61.4%)        ↓ No (38.6%)
바로 응답              V2 호출
```

**Rule 커버리지:**
- 44개 예외 타입 전체 커버
- Oracle 에러 코드 (ORA-XXXXX)
- Java 예외 패턴 (스택트레이스, Caused by 등)

**성능:**
- Accuracy: 78.4% ⭐
- Precision: 73.4%
- Recall: 65.1%
- F1 Score: 67.3%

**Method Distribution:**
- Rule Only (Fast Path): 307건 (61.4%)
- V2 Fallback: 193건 (38.6%)

**장점:**
- ✅ **최고 정확도** (78.4%)
- ✅ **빠른 응답** (61.4%는 0.01초 이내)
- ✅ Rule 매칭 시 거의 100% 정확
- ✅ V2의 장점 유지 (상세 분석)
- ✅ 하이브리드 접근으로 속도와 정확도 균형

**개선 사항:**
- Rule 패턴을 5개 → 44개로 확장
- 엄격한 매칭 조건 (스택트레이스, Caused by 등)
- V2 파싱 로직 개선 (V2 단독 평가와 동일하게)

**최적화 포인트:**
- 명확한 패턴은 Rule로 빠르게 처리
- 애매한 경우만 V2 호출 (정확도 유지)

---

## 🔍 상세 비교

### 정확도 (Accuracy)

```
V1: ████████████████████ 47.8%
V2: ████████████████████████████████████████ 76.6%
V3: ██████████████████████████████████████████ 78.4% ⭐
```

### Precision (정밀도)

```
V1: ████████████████ 39.6%
V2: █████████████████████████████████████ 74.9% ⭐
V3: ████████████████████████████████████ 73.4%
```

### Recall (재현율)

```
V1: ████████████████ 39.6%
V2: ████████████████████████████████ 64.7% ⭐
V3: ████████████████████████████████ 65.1%
```

### F1 Score

```
V1: ██████████████ 34.9%
V2: ██████████████████████████████████ 67.9% ⭐
V3: █████████████████████████████████ 67.3%
```

---

## 💡 핵심 인사이트

### 1. 2-Stage 파이프라인의 효과
- V1 → V2: **+28.8% 정확도 향상**
- Stage 2가 Stage 1의 오류를 보정
- 구조화된 출력으로 실용성 증가

### 2. Rule-based의 가치
- V2 → V3: **+1.8% 정확도 향상**
- 61.4%의 케이스를 0.01초 이내 처리
- 명확한 패턴에 대해 거의 100% 정확

### 3. Precision vs Recall 트레이드오프
- V2: 높은 Precision (74.9%), 낮은 Recall (64.7%)
- V3: 약간 낮은 Precision (73.4%), 비슷한 Recall (65.1%)
- Rule이 일부 False Positive 발생 (엄격한 매칭으로 개선)

### 4. 실전 배포 전략
- **빠른 응답 필요**: V3 사용 (Rule Fast Path)
- **최고 정밀도 필요**: V2 사용 (Precision 74.9%)
- **최고 정확도 필요**: V3 사용 (Accuracy 78.4%)

---

## 🚀 최종 권장 사항

### 프로덕션 배포: **V3 (Hybrid)**

**이유:**
1. **최고 정확도** (78.4%)
2. **빠른 응답** (61.4%는 Rule로 즉시 처리)
3. **확장 가능** (Rule 추가로 Fast Path 증가)
4. **안정적** (Rule 실패 시 V2 Fallback)

### 향후 개선 방향

1. **Rule 확장**
   - 더 많은 패턴 추가
   - Fast Path 비율 증가 (61.4% → 80%+)

2. **Stage 2 개선**
   - Fine-tuning으로 정확도 향상
   - 더 구조화된 출력 생성

3. **앙상블**
   - 여러 모델의 예측 결합
   - Confidence 기반 가중치

4. **실시간 학습**
   - 사용자 피드백 반영
   - 지속적인 모델 개선

---

## 📁 파일 구조

```
log-analyzer/
├── model/src/
│   ├── pipeline_end2end.py          # V2: End-to-End
│   ├── pipeline_v3_rule_based.py    # V3: Hybrid
│   └── compare_all_versions.py      # 전체 비교
├── config/
│   └── solution_errors.yml          # Rule 정의 (44개 예외)
└── results/
    ├── end2end_evaluation.json      # V2 결과
    ├── v3_rule_based_evaluation.json # V3 결과
    └── all_versions_comparison.json  # 전체 비교
```

---

## 🎓 결론

**금융권 로그 분석기는 3단계 진화를 거쳐 78.4%의 정확도를 달성했습니다.**

1. **V1 (47.8%)**: 단순 분류기
2. **V2 (76.6%)**: 2-Stage 파이프라인 (+28.8%)
3. **V3 (78.4%)**: Hybrid 접근 (+1.8%)

**V3 Hybrid 모델은 속도와 정확도를 모두 만족하는 최적의 솔루션입니다.**

---

*평가 데이터: 500 샘플, 42개 예외 타입*  
*평가 일시: 2025-10-14*  
*디바이스: Apple Silicon (MPS)*
